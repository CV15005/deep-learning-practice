# Лабораторная работа №5
# Обучение модели YOLO на собственном датасете


1. Выполните разметку собранного вами датасета изображений с помощью средства разметки CVAT.

2. Обучите модель YOLOv11 от Ultralytics в google colab или kaggle (с использованием GPU).



## CVAT
CVAT является одним из популярных решений для разметки изображений.

Его можно развернуть как локально (через docker), так и на сервере (тоже через docker, развернув сервис, например, на арендованной виртуальной машине).

Еще доступна версия от разработчиков CVAT (https://app.cvat.ai/), где можно создать аккаунт и выполнить необходимую разметку. В этом случае есть ограничения на число создаваемых задач и недоступность некоторых функций.

Предлагается выполнить разметку изображений в веб-версии от разработчиков.


Сформируйте набор изображений.
Поскольку это учебный пример, общее число изображений может быть небольшим (30-50). Если у вас есть задача по учебным проектам, связанная с обучением моделей детекции, можно взять вашу выборку.

Создайте папку датасета `mydataset`.
Внутри этой папки создайте следующую иерархию:
```
mydataset/
├── train/
│   └── images/
│       ├── image_1.jpg
│       └── image_2.jpg
│       └── ...
│   └── labels/
│       ├── image_1.txt
│       └── image_2.txt
│       └── ...
├── valid/
│   └── images/
│       ├── image_31.jpg
│       └── image_32.jpg
│       └── ...
│   └── labels/
│       ├── image_31.txt
│       └── image_32.txt
│       └── ...
├── test/
│   └── images/
│       ├── image_41.jpg
│       └── image_42.jpg
│       └── ...
│   └── labels/
│       ├── image_41.txt
│       └── image_42.txt
│       └── ...
└── data.yaml
```

Файлы разметки в txt-формате получим из средства разметки CVAT.

Файл data.yaml заполним чуть позже.

Разбейте изображения на обучающую, валидационную и тестовую выборку и поместите их в соответствующие папки.


## Разметка в CVAT
Зарегистрируйтесь на сайте https://app.cvat.ai/

Создайте новый проект (Create new project).

Задайте имя проекта.
Добавьте класс меток (Add label).
Label name - это имя класса, в качестве типа разметки выберите Rectangle.
Сохраните изменения.

Во вкладке созданного проекта создайте новую задачу (Create new task).
Задайте имя задачи, в качестве Subset выберите сначала Train (в итоге у вас должно быть 3 задачи, по задаче для Train, Validation, Test).

Загрузите изображения для разметки.
Сохраните изменения.

На вкладке задачи выберите созданную Job.
Выполните разметку изображений в интерфейсе.
Сохраните изменения.

Создайте аналогичные задачи для Subset: Validation, Test.


После разметки выгрузите ее результаты. Перейдите на вкладку проектов, нажмите на три точки нужного проекта, выберите Export dataset.
В качестве формата экспорта выберите 
Ultralytics YOLO Detection 1.0.



Теперь необходимо организовать датасет нужным образом.
Разархивируйте архив.
Содержимое папок в папке `labels` переместите в папки нашего датасета:
```
txt-файлы из labels/Train -> в mydataset/train/labels/
txt-файлы из labels/Validation -> в mydataset/valid/labels/
txt-файлы из labels/Test -> в mydataset/test/labels/
```

В папке `mydataset` создайте файл `data.yaml` со следующим содержимым:

для google colab
```
test: test/images
train: train/images
val: valid/images
nc: 1 # число классов
names: ['my_class'] # измените на название класса
path: /content/mydataset # измените на абсолютный путь до датасета
```

для kaggle
```
test: test/images
train: train/images
val: valid/images
nc: 1 # число классов
names: ['my_class'] # измените на название класса
path: /kaggle/input/mydataset # измените на абсолютный путь до датасета
```


Теперь готовый датасет можно загрузить в google colab или kaggle и обучить yolo-модель.


## Обучение модели
Обучите модель, оцените метрики, постройте матрицы ошибок (результаты автоматически сохраняются в папке `runs`).
Выполните инференс на тестовых изображениях (веса лучшей модели сохраняются по пути `runs/detect/train/weights/best.pt`).


[Пример обучения модели в google colab](https://colab.research.google.com/drive/1iBQpOMQT2UDdoJMpMUNtlNvp2ZHLJaqa?usp=sharing)

[Пример обучения модели в kaggle](https://www.kaggle.com/code/kvsbmstu/train-yolo-custom-dataset)





## Roboflow

Другое решение для разметки - платформа Roboflow.

https://roboflow.com/

Здесь можно тоже можно разметить свой датасет, но есть ограничения в бесплатном тарифе. Также датасет будет публичным. На платформе встроены средства автоматической разметки (тоже со своими лимитами).

https://app.roboflow.com/


На платформе можно найти множество датасетов, выгрузить их в нужном формате.

https://universe.roboflow.com/

Можно скачать нужный датасет, например, с roboflow в colab, добавив код загрузки датасета по его имени.

[Примеры блокнотов работы с roboflow](https://github.com/roboflow/notebooks)

[Ссылка на вебинар по использованию ИИ в медицинских задачах - про Roboflow c 37 минуты](https://vkvideo.ru/video-145052891_456247987?utm_source=email&utm_medium=email&utm_campaign=otus&utm_content=auto&utm_term=after_ol&relogin=True)

